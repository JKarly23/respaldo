<!-- Aside para crear filtro personalizado -->
<div id="filtroPersonalizadoAside" class="position-fixed bg-white shadow-lg" style="top: 0; right: -400px; width: 400px; height: 100vh; z-index: 1060; transition: right 0.3s ease;">
    <div class="d-flex flex-column h-100">
        <!-- Cabecera -->
        <div class="p-3 border-bottom">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Nuevo Filtro Personalizado</h5>
                <button type="button" class="close" id="cerrarAside" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </div>
        
        <!-- Cuerpo del formulario -->
        <div class="p-3 flex-grow-1 overflow-auto">
            <form id="formFiltroPersonalizado">
                <div id="condicionesContainer">
                    <!-- Condición inicial -->
                    <div class="condicion mb-3">
                        <div class="form-row">
                            <div class="col-md-5">
                                <label>Campo</label>
                                <select class="form-control campo-select">
                                    <option value="">Seleccionar campo</option>
                                    <option value="nombre">Nombre</option>
                                    <option value="tipo">Tipo</option>
                                    <option value="estado">Estado</option>
                                    <option value="rector">Rector</option>
                                    <option value="sitio_web">Sitio Web</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label>Operador</label>
                                <select class="form-control operador-select">
                                    <option value="igual">Es igual a</option>
                                    <option value="contiene">Contiene</option>
                                    <option value="comienza">Comienza con</option>
                                    <option value="termina">Termina con</option>
                                    <option value="mayor">Mayor que</option>
                                    <option value="menor">Menor que</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label>Valor</label>
                                <input type="text" class="form-control valor-input">
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button type="button" class="btn btn-link text-danger eliminar-condicion p-0 mb-2">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Botón para agregar condición -->
                <div class="mb-3">
                    <button type="button" id="agregarCondicion" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-plus-circle"></i> Agregar condición
                    </button>
                </div>
                
                <!-- Operador lógico -->
                <div class="form-group mb-3">
                    <label>Operador lógico entre condiciones</label>
                    <div class="btn-group btn-group-toggle w-100" data-toggle="buttons">
                        <label class="btn btn-outline-secondary active">
                            <input type="radio" name="operadorLogico" id="opAND" value="AND" checked> AND (Y)
                        </label>
                        <label class="btn btn-outline-secondary">
                            <input type="radio" name="operadorLogico" id="opOR" value="OR"> OR (O)
                        </label>
                    </div>
                    <small class="form-text text-muted">Si no selecciona una opción, por defecto se aplicará el operador AND.</small>
                </div>
            </form>
        </div>
        
        <!-- Pie con botones -->
        <div class="p-3 border-top">
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" id="cancelarFiltro">Cancelar</button>
                <div>
                    <button type="button" class="btn btn-primary mr-2" id="aplicarFiltro">Aplicar filtro</button>
                    <button type="button" class="btn btn-success" id="guardarFiltro">Guardar filtro</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para guardar filtro -->
<div class="modal fade" id="guardarFiltroModal" tabindex="-1" role="dialog" aria-labelledby="guardarFiltroModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="guardarFiltroModalLabel">Guardar Filtro</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="nombreFiltro">Nombre del filtro</label>
                    <input type="text" class="form-control" id="nombreFiltro" placeholder="Ej: Universidades públicas">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" id="confirmarGuardarFiltro">Guardar</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Referencias a elementos
    const crearFiltroBtn = document.getElementById('crearFiltroPersonalizado');
    const aside = document.getElementById('filtroPersonalizadoAside');
    const cerrarAsideBtn = document.getElementById('cerrarAside');
    const cancelarFiltroBtn = document.getElementById('cancelarFiltro');
    const agregarCondicionBtn = document.getElementById('agregarCondicion');
    const condicionesContainer = document.getElementById('condicionesContainer');
    const guardarFiltroBtn = document.getElementById('guardarFiltro');
    const confirmarGuardarFiltroBtn = document.getElementById('confirmarGuardarFiltro');
    const aplicarFiltroBtn = document.getElementById('aplicarFiltro');
    
    // Abrir el aside
    crearFiltroBtn.addEventListener('click', function(e) {
        e.preventDefault();
        aside.style.right = '0';
        document.body.style.overflow = 'hidden'; // Evitar scroll en el body
    });
    
    // Cerrar el aside
    function cerrarAside() {
        aside.style.right = '-400px';
        document.body.style.overflow = ''; // Restaurar scroll
    }
    
    cerrarAsideBtn.addEventListener('click', cerrarAside);
    cancelarFiltroBtn.addEventListener('click', cerrarAside);
    
    // Agregar nueva condición
    agregarCondicionBtn.addEventListener('click', function() {
        const nuevaCondicion = document.querySelector('.condicion').cloneNode(true);
        // Limpiar valores
        nuevaCondicion.querySelectorAll('select, input').forEach(el => {
            if (el.tagName === 'SELECT') {
                el.selectedIndex = 0;
            } else if (el.type === 'text') {
                el.value = '';
            }
        });
        
        // Agregar evento para eliminar esta condición
        nuevaCondicion.querySelector('.eliminar-condicion').addEventListener('click', function() {
            nuevaCondicion.remove();
        });
        
        condicionesContainer.appendChild(nuevaCondicion);
    });
    
    // Eliminar condición (para la primera condición)
    document.querySelector('.eliminar-condicion').addEventListener('click', function() {
        if (document.querySelectorAll('.condicion').length > 1) {
            this.closest('.condicion').remove();
        } else {
            alert('Debe haber al menos una condición');
        }
    });
    
    // Abrir modal para guardar filtro
    guardarFiltroBtn.addEventListener('click', function() {
        // Usar Bootstrap 4 modal
        $('#guardarFiltroModal').modal('show');
    });
    
    // Guardar filtro
    confirmarGuardarFiltroBtn.addEventListener('click', function() {
        const nombreFiltro = document.getElementById('nombreFiltro').value.trim();
        
        if (!nombreFiltro) {
            alert('Por favor, ingrese un nombre para el filtro');
            return;
        }
        
        // Aquí iría la lógica para guardar el filtro
        console.log('Filtro guardado:', nombreFiltro);
        
        // Cerrar modal y aside
        $('#guardarFiltroModal').modal('hide');
        cerrarAside();
        
        // Opcional: Actualizar la lista de filtros guardados
        // actualizarListaFiltros(nombreFiltro);
    });
    
    // Aplicar filtro sin guardar
    aplicarFiltroBtn.addEventListener('click', function() {
        // Aquí iría la lógica para aplicar el filtro
        console.log('Aplicando filtro...');
        // No cerramos el aside como solicitado
        
        // Opcional: Mostrar alguna indicación de que el filtro se aplicó
        alert('Filtro aplicado correctamente');
    });
});
</script>